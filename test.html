<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webcam with Two-Color Dither</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #f0f0f0;
            overflow: hidden;
        }

        canvas {
            border: 2px solid #000;
        }


    </style>
</head>
<body>



<canvas id="mycanvas" width="640" height="480"></canvas>

<script>
     // 3x3 Bayer matrix for ordered dithering
     const bayerMatrix = [
        [0, 128, 32],
        [192, 64, 224],
        [48, 160, 96]
    ];

    const matrixSize = 3; // Size of the matrix

    // Adjust canvas size to match screen size
    const canvas = document.getElementById('mycanvas');
    const ctx = canvas.getContext('2d');

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // Request webcam access (front or rear camera for mobile)
    const constraints = {
        video: {
            facingMode: 'user' // Change to 'user' for front-facing camera
        }
    };

    navigator.mediaDevices.getUserMedia(constraints)
        .then((stream) => {
            const video = document.createElement('video');
            video.srcObject = stream;
            video.play();

            // Function to apply ordered dither effect
            function applyDitherEffect() {
                // Draw the webcam video feed onto the canvas
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

                // Get the pixel data from the canvas
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                const data = imageData.data;

                // Loop through each pixel
                for (let y = 0; y < canvas.height; y++) {
                    for (let x = 0; x < canvas.width; x++) {
                        const index = (y * canvas.width + x) * 4;
                        const r = data[index];
                        const g = data[index + 1];
                        const b = data[index + 2];

                        // Calculate brightness as grayscale
                        const brightness = 0.2126 * r + 0.7152 * g + 0.0722 * b;

                        // Apply ordered dithering using the Bayer matrix
                        const threshold = bayerMatrix[y % matrixSize][x % matrixSize];

                        // Map brightness to black or white based on Bayer matrix threshold
                        const color = brightness > threshold ? 255 : 0;

                        // Set the pixel color to either black or white
                        data[index] = data[index + 1] = data[index + 2] = color;
                    }
                }

                // Update the canvas with the dithered image data
                ctx.putImageData(imageData, 0, 0);
            }

            // Loop to apply the dither effect continuously
            function renderLoop() {
                applyDitherEffect();
                requestAnimationFrame(renderLoop);
            }

            // Start the render loop
            renderLoop();
        })
        .catch((error) => {
            console.error('Webcam access error:', error);
            alert('Error accessing the camera: ' + error.message);
        });
</script>

</body>
</html>
